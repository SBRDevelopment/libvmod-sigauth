varnishtest "Test sigauth vmod"

server s1 {
       rxreq
       txresp
} -start

varnish v1 -vcl+backend {
        import sigauth from "${vmod_topbuild}/src/.libs/libvmod_sigauth.so";

        sub vcl_deliver {
                set resp.http.sigstring = sigauth.sigstring(req.request, req.url, req.http.date, req.http.host);
        }
} -start

client c1 {
	txreq -url "/" -hdr "Date: 2013-01-15T00:00:00" -hdr "Host: api.sbrfeeds.com"
        rxresp
	expect resp.http.sigstring == "2013-01-15T00:00:00 api.sbrfeeds.com"
}

client c1 -run
